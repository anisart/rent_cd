<head>
    <title>Rent CD</title>

    <script type="text/javascript" src="webix-meteor.js"></script>
</head>
<body>
<script type="text/javascript">
    webix.ready(function(){
        webix.protoUI({
            name:"editlist"
        }, webix.EditAbility, webix.ui.list);

        genresCell =
        {
            header:"Genre",
            body:{
                container:"listGenre",
                type:"space",
                rows:[
                    {
                        view:"toolbar",
                        width:320,
                        cols:[
                        {
                            view:"button",
                            value:"Add New Genre",
                            width:150,
                            type:"form",
                            align:"left",
                            click:function(){
                                var row = $$("listGenres").add({
                                    title:"New title"
                                });
                            }
                        },
                        {},
                        {
                            view:"button",
                            value:"Delete Genre",
                            width:150,
                            type:"danger",
                            align:"right",
                            click:function(){
                                var id = $$("listGenres").getSelectedId();
                                if (id)
                                    $$("listGenres").remove(id);
                                else
                                    webix.message("Please select any row first");
                            }
                        }]
                    },
                    {
                        cols:[
                        {
                            view:"editlist",
                            id:"listGenres",
                            template:"#title#",
                            url:webix.proxy('meteor', Genres),
                            save:webix.proxy('meteor', Genres),

                            autoConfig: true,
                            editable:true,
                            editaction:"dblclick",
                            editor:"text",
                            editValue:"title",
                            navigation:true,
                            select:"cell",
                            width:320
                        }]
                    }
                ]
            }
        };

        movieMakersCell =
        {
            header:"Movie Makers",
            body:{
                container:"listMM",
                type:"space",
                rows:[
                    {
                        view:"toolbar",
                        width:500,
                        cols:[
                        {
                            view:"button",
                            value:"Add New Movie maker",
                            width:200,
                            type:"form",
                            align:"left",
                            click:function(){
                                var row = $$("listMMakers").add({
                                    title:"New title"
                                });
                            }
                        },
                        {},
                        {
                            view:"button",
                            value:"Delete Movie maker",
                            width:200,
                            type:"danger",
                            align:"right",
                            click:function(){
                                var id = $$("listMMakers").getSelectedId();
                                if (id)
                                    $$("listMMakers").remove(id);
                                else
                                    webix.message("Please select any row first");
                            }
                        }
                    ]
                    },
                    {
                        cols:[
                        {
                            view:"editlist",
                            id:"listMMakers",
                            template:"#title#",
                            url:webix.proxy('meteor', MovieMakers),
                            save:webix.proxy('meteor', MovieMakers),

                            autoConfig: true,
                            editable:true,
                            editaction:"dblclick",
                            editor:"text",
                            editValue:"title",
                            navigation:true,
                            select:"cell",
                            width:500
                        }]
                    }
                ]
            }
        };

        actorsCell =
        {
            header:"Actors and Directors",
            body:{
                container:"listActor",
                type:"space",
                rows:[
                    {
                        view:"toolbar",
                        width:500,
                        cols:[
                            {
                                view:"button",
                                value:"Add New Actor or Director",
                                width:200,
                                type:"form",
                                align:"left",
                                click:function(){
                                    $$("editlistActors").add({
                                        fname:"New firstname",
                                        sname:"New surname",
                                        dateActor:"10/01/1990"
                                    },0)
                                }
                            },
                            {},
                            {
                                view:"button",
                                value:"Delete Actor or Director",
                                width:200,
                                type:"danger",
                                align:"right",
                                click:function(){
                                    var id = $$("editlistActors").getSelectedId();
                                    if (id) {
                                        $$("editlistActors").remove(id);
                                    }
                                    else
                                        webix.message("Please select any row first");
                                }
                            }
                        ]
                    },
                    {
                        cols:[
                            {
                                /*
                                view:"datatable",
                                id:"datatableActors",
                                columns:[
                                    { id:"fname",	 editor:"text",	header:"FirstName",     width:250},
                                    { id:"sname",	 editor:"text",	header:"SurName",	    width:250},
                                    { id:"dateActor",editor:"date",	header:"Date of Birth", width:150,
                                        format:webix.Date.dateToStr("%m/%d/%y")}
                                ],
                                */

                                view:"editlist",
                                id:"editlistActors",
                                template:"#fname# #sname#",

                                width:300,
                                select:true,
                                autoConfig:true,
                                url:webix.proxy('meteor', Actors),
                                save:webix.proxy('meteor', Actors)
                            },
                            {width:10},
                            {
                                rows:[
                                    {
                                        view:"form",
                                        id:"formActors",
                                        scroll:false,
                                        width:600,
                                        elements:[
                                            {
                                                view:"text",
                                                name:"fname",
                                                label:"FirstName"
                                            },
                                            {
                                                view:"text",
                                                name:"sname",
                                                label:"SurName"
                                            },
                                            {
                                                view:"datepicker",
                                                value:"1.2014.1",
                                                name:"dateActor",
                                                label:"Date of Birth"
                                            }
                                        ]
                                    },
                                    {
                                        view: "button",
                                        value: "Save",
                                        width: 100,
                                        click:function(){
                                            $$("formActors").save();
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        };

        sellersCell =
        {
            header:"Sellers",
            body:{
                container:"listSeller",
                type:"space",
                rows:[
                    {
                        view:"toolbar",
                        width:500,
                        cols:[
                            {
                                view:"button",
                                value:"Add New Seller",
                                width:200,
                                type:"form",
                                align:"left",
                                click:function(){
                                    $$("editlistSellers").add({
                                        fname:"Firstname", sname:"Surname", pname:"",
                                        spassport:"", npassport:"", ipassport:"", apassport:""
                                    },0)
                                }
                            },
                            {},
                            {
                                view:"button",
                                value:"Delete Sellers",
                                width:200,
                                type:"danger",
                                align:"right",
                                click:function(){
                                    var id = $$("editlistSellers").getSelectedId();
                                    if (id) {
                                        $$("editlistSellers").remove(id);
                                    }
                                    else
                                        webix.message("Please select any row first");
                                }
                            }
                        ]
                    },
                    {
                        cols:[
                            {
                                view:"editlist",
                                id:"editlistSellers",
                                template:"#sname# #fname# #pname#",

                                width:300,
                                select:true,
                                autoConfig:true,
                                url:webix.proxy('meteor', Sellers),
                                save:webix.proxy('meteor', Sellers)
                            },
                            {width:10},
                            {
                                rows:[
                                    {
                                        view:"form",
                                        id:"formSellers",
                                        scroll:false,
                                        width:600,
                                        elements:[
                                            {
                                                view:"text",
                                                name:"sname",
                                                label:"SurName"
                                            },
                                            {
                                                view:"text",
                                                name:"fname",
                                                label:"FirstName"
                                            },
                                            {
                                                view:"text",
                                                name:"pname",
                                                label:"PatronymicName"
                                            },
                                            {
                                                view:"text",
                                                name:"spassport",
                                                label:"Passport series"
                                            },
                                            {
                                                view:"text",
                                                name:"npassport",
                                                label:"Passport series"
                                            },
                                            {
                                                view:"text",
                                                name:"ipassport",
                                                label:"Issuance of passport"
                                            },
                                            {
                                                view:"text",
                                                name:"apassport",
                                                label:"Address"
                                            }
                                        ]
                                    },
                                    {
                                        view: "button",
                                        value: "Save",
                                        width: 100,
                                        click:function(){
                                            //add checking for unique spassport and npassport
                                            $$("formSellers").save();
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        };

        catalogueCdCell =
        {
            header:"CD catalogue",
            body:{
                container:"listCatalogue",
                type:"space",
                rows:[
                    {
                        view:"toolbar",
                        width:500,
                        cols:[
                            {
                                view:"button",
                                value:"Add New CD",
                                width:200,
                                type:"form",
                                align:"left",
                                click:function(){
                                    $$("editlistCatalogue").add({
                                        mname:"", mrate:"",
                                        mallnum:0, mallnumnow:0, mpriceperday:"",
                                        mgenres:"", mmoviemakers:"",
                                        mactors:"", mdirectors:""
                                    },0)
                                }
                            },
                            {},
                            {
                                view:"button",
                                value:"Delete CD",
                                width:200,
                                type:"danger",
                                align:"right",
                                click:function(){
                                    var id = $$("editlistCatalogue").getSelectedId();
                                    if (id) {
                                        $$("editlistCatalogue").remove(id);
                                    }
                                    else
                                        webix.message("Please select any row first");
                                }
                            }
                        ]
                    },
                    {
                        cols:[
                            {
                                view:"editlist",
                                id:"editlistCatalogue",
                                template:"#mname#",

                                width:300,
                                select:true,
                                autoConfig:true,
                                url:webix.proxy('meteor', CDCatalogue),
                                save:webix.proxy('meteor', CDCatalogue)
                            },
                            {width:10},
                            {
                                rows:[
                                    {
                                        view:"form",
                                        id:"formCatalogue",
                                        scroll:false,
                                        width:600,

                                        elements:[
                                            {
                                                view:"text",
                                                name:"mname",
                                                label:"Movie Name"
                                            },
                                            {
                                                view:"text",
                                                name:"mrate",
                                                label:"Movie Rate"
                                            },
                                            {
                                                view:"counter",
                                                name:"mallnum",
                                                label:"All copies",
                                                step:1,
                                                min:0
                                            },
                                            {
                                                view:"text",
                                                name:"mallnumnow",
                                                label:"All copies for now",
                                                //editable:false,//do not work
                                                step:1,
                                                min:0
                                            },
                                            {
                                                view:"text",
                                                name:"mpriceperday",
                                                label:"Price per day"
                                            },
                                            {
                                                view:"combo",
                                                name:"mgenres",
                                                label:"List of genres",
                                                options:webix.proxy('meteor', Genres)
                                                //collection:Genres,
                                                //collection:webix.proxy('meteor', Genres),
                                                //header:"title"
                                            },
                                            {
                                                view:"combo",
                                                name:"mmoviemakers",
                                                label:"List of movie makers",
                                                options:webix.proxy('meteor', MovieMakers)
                                            },
                                            {
                                                view:"combo",
                                                name:"mactors",
                                                label:"List of actors",
                                                options:webix.proxy('meteor', Actors)
                                            },
                                            {
                                                view:"richselect",
                                                name:"mdirectors",
                                                label:"List of directors",
                                                options:webix.proxy('meteor', Actors)
                                            }
                                        ]
                                    },
                                    {
                                        view: "button",
                                        value: "Save",
                                        width: 100,
                                        click:function(){
                                            $$("formCatalogue").save();
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        };

        webix.ui({
            view:"tabview",
            cells:[
                genresCell,
                movieMakersCell,
                actorsCell,
                sellersCell,
                catalogueCdCell
            ],
            width:"100%",
            height:"100%"
        });

        $$('formActors').bind('editlistActors');
        $$('formSellers').bind('editlistSellers');
        $$('formCatalogue').bind('editlistCatalogue');

    });

</script>
<div id="listGenre"></div>
<div id="listMM"></div>
<div id="listActor"></div>
<div id="listSeller"></div>
<div id="listCatalogue"></div>
</body>